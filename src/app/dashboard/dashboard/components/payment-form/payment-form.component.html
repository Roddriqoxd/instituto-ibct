<div class="max-w-7xl mx-auto bg-white rounded-lg shadow-sm">
  <div class="p-6 border-b border-gray-200">
    <h1 class="text-2xl font-bold text-gray-800">Registrar Pago</h1>
    <p class="text-gray-600 mt-1">> Registro de pago del estudiante</p>
  </div>

  <form class="p-6 space-y-4 bg-white rounded-lg shadow"
        [formGroup]="pagoForm"
        (ngSubmit)="onSubmitPago()">

    <!-- Estudiante -->
    <div>
      <label class="block text-gray-700 font-semibold mb-1">Estudiante:</label>
      <p-dropdown
        [options]="estudiantes"
        optionLabel="estudiante.nombre"
        optionValue="id"
        formControlName="estudianteId"
        class="w-full"
        placeholder="Seleccione un estudiante"
        filter="true"
        filterPlaceholder="Buscar por nombre...">
      </p-dropdown>
    </div>

    <div *ngIf="estudianteSeleccionado" class="p-4 mt-4 bg-gray-50 rounded-md shadow-inner space-y-2 border border-gray-200">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">Informaci贸n del estudiante</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
        <div><strong>Nombre:</strong> {{ estudianteSeleccionado.estudiante.nombre }}</div>
        <div><strong>Estado:</strong> {{ estudianteSeleccionado.estado }}</div>
        <div><strong>Curso:</strong> {{ estudianteSeleccionado.curso.nombre }}</div>
        <div><strong>Modalidad:</strong> {{ estudianteSeleccionado.curso.modalidad }}</div>
        <div><strong>Duraci贸n:</strong> {{ estudianteSeleccionado.curso.duracionMeses | tiempoMeses }}</div>
        <div><strong>Turno:</strong> {{ estudianteSeleccionado.horario.turno }}</div>
        <div><strong>Horario:</strong> {{ estudianteSeleccionado.horario.horaInicio }} - {{estudianteSeleccionado.horario.horaFin}}</div>
        <div><strong>Fecha de inicio de clases:</strong> {{ estudianteSeleccionado.fechaInicio | date:'longDate' }}</div>
      </div>

        <div class="mt-6">
          <h3 class="font-semibold text-gray-700 mb-2">Pagos de mensualidad</h3>
          <div class="flex flex-wrap gap-2">
            <ng-container *ngFor="let item of mensualidadesDisplay">
              <div
                class="w-25 h-13 p-2 rounded shadow text-xs text-white flex flex-col justify-center items-center"
                [ngClass]="item.pagado ? 'bg-orange-400' : 'bg-gray-300 text-gray-700'">
                <ng-container *ngIf="item.pagado">
                  <div>Bs {{ item.monto }}</div>
                  <div>{{ item.fecha | date:'dd/MM/yyyy' }}</div>
                </ng-container>
                <ng-container *ngIf="!item.pagado">
                  <div>Mensualidad</div>
                  <div>Pendiente</div>
                </ng-container>
              </div>
            </ng-container>
          </div>
        </div>

      <div class="mt-6">
        <h3 class="font-semibold text-gray-700 mb-2">Pago certificado</h3>
        <div class="flex flex-wrap gap-2">
          <div
            class="w-25 h-13 p-2 rounded shadow text-xs text-white flex flex-col justify-center items-center"
            [ngClass]="certificadoDisplay?.pagado ? 'bg-orange-400' : 'bg-gray-300 text-gray-700'">
            <ng-container *ngIf="certificadoDisplay?.pagado">
              <div>Bs {{ certificadoDisplay?.monto }}</div>
              <div>{{ certificadoDisplay?.fecha | date:'dd/MM/yyyy' }}</div>
            </ng-container>
            <ng-container *ngIf="!certificadoDisplay?.pagado">
              <div>Pago</div>
              <div>Pendiente</div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- Tipo de pago -->
    <div>
      <label class="block text-gray-700 font-semibold mb-1">Tipo de pago:</label>
      <p-dropdown
        [options]="tiposPago"
        optionLabel="label"
        optionValue="value"
        formControlName="tipoPago"
        class="w-full"
        placeholder="Seleccione tipo de pago">
      </p-dropdown>
    </div>

    <!-- Monto / Abono -->
<!--    <div>-->
<!--      <label class="block text-gray-700 font-semibold mb-1">Monto / Abono:</label>-->
<!--      <input pInputText type="number" formControlName="monto" class="w-full" placeholder="Ej: 200.00" />-->
<!--    </div>-->

    <div class="flex align-center" style="padding-top: 20px">
      <div class="flex gap-2">
        <label class="text-sm" [style.color]="!checked ? 'green' : 'black'">Al contado</label>
        <p-toggleswitch (onChange)="onchange($event.checked)"/>
        <label class="text-sm" [style.color]="checked ? 'green' : 'black'">A saldo</label>
      </div>
    </div>

    @if (!checked) {
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium">Abono</label>
          <input pInputText formControlName="monto" type="number" class="w-full"/>
        </div>
      </div>
    } @else {
      <div class="grid grid-cols-2 gap-4">

        <div>
          <label class="block text-sm font-medium">Cuenta</label>
          <input #cuenta formControlName="monto" type="number" pInputText class="w-full" />
        </div>

        <div>
          <label class="block text-sm font-medium">Saldo (Pago pendiente)</label>
          <input #saldo type="number" pInputText class="w-full" />
        </div>

        <div>
          <label class="block text-sm font-medium">Total</label>
          <input pInputText  class="w-full" [value]="sumarTotal(cuenta.value , saldo.value)" readonly/>
        </div>
      </div>
    }

    <!-- Descripci贸n -->
    <div>
      <label class="block text-gray-700 font-semibold mb-1">Detalle (opcional):</label>
      <textarea pInputTextarea formControlName="descripcion" class="w-full" rows="3" placeholder="Opcional..."></textarea>
    </div>

    <!-- Bot贸n enviar -->
    <div>
      <button type="submit"
              pButton
              label="Registrar Pago"
              [disabled]="pagoForm.invalid">
      </button>
    </div>

  </form>
</div>

<button
  pButton
  type="button"
  label="Ver Recibo"
  icon="pi pi-eye"
  (click)="abrirRecibo(pagos[1])"
></button>

<app-recibo-pago
  *ngIf="pagoSeleccionado"
  [(visible)]="modalVisible"
  [pago]="pagoSeleccionado"
></app-recibo-pago>
